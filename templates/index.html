<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>FraudShield - SMS Fraud Detector</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background: linear-gradient(135deg, #1f2937, #3b82f6);
      color: #fff;
      min-height: 100vh;
      font-family: 'Poppins', sans-serif;
      margin: 0;
    }
    .card {
      border-radius: 1.5rem;
      box-shadow: 0 8px 25px rgba(0,0,0,0.3);
      background-color: #ffffff;
      color: #333;
      padding: 2rem;
      max-width: 720px;
      width: 100%;
    }
    .progress { height: 20px; }
    #demoToast {
      position: fixed;
      bottom: 80px;
      left: 20px;
      z-index: 1060;
      min-width: 320px;
      max-width: 420px;
    }
    .toast-header {
      border-bottom: none;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    #plusBtn {
      position: fixed;
      bottom: 20px;
      left: 20px;
      z-index: 1056;
      border-radius: 30px;
      font-weight: 600;
      padding: 10px 20px;
      background: #16a34a;
      color: #fff;
      border: none;
    }
    .navbar { border-bottom: 1px solid #d1d5db; }
    .nav-link { color: #3b82f6 !important; font-weight: 600; }
    .nav-link:hover { text-decoration: underline; }
    .navbar-text { color: #3b82f6 !important; }
    .main-content {
      margin-top: 20px;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding-left: 1rem;
      padding-right: 1rem;
      padding-bottom: 120px;
    }

    /* Popup - matched to CyberInfo sizing */
    #helpPopup {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #fff;
      color: #000;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.3);
      width: 320px;
      z-index: 1055;
      display: block;
      font-size: 15px;
      line-height: 1.5;
    }
    #helpPopup .popup-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    #helpPopup .popup-title {
      color: red;
      margin: 0;
      font-weight: 700;
      font-size: 18px;
    }
    #helpPopup .popup-close {
      color: black;
      font-weight: 700;
      cursor: pointer;
      font-size: 20px;
      transition: transform 0.2s;
    }
    #helpPopup .popup-close:hover { transform: scale(1.2); }
    #helpPopup .popup-sub {
      font-weight: 600;
      margin: 5px 0 10px 0;
    }
    #helpPopup ul {
      margin: 0;
      padding-left: 20px;
    }
    #helpPopup ul li {
      margin-bottom: 8px;
    }
    #helpPopupMin {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: #dc3545;
      color: white;
      padding: 10px 25px;
      border-radius: 25px;
      cursor: pointer;
      z-index: 1056;
      font-weight: 600;
      font-size: 14px;
      display: none;
    }
    @media (max-width: 480px) {
      #helpPopup { right: 10px; left: 10px; width: auto; }
      #demoToast { left: 10px; right: 10px; min-width: auto; }
    }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
    <div class="container-fluid justify-content-between">
      <a class="navbar-brand" href="/">
        <img src="{{ url_for('static', filename='sms.jpeg') }}" alt="Logo" style="height:40px;">
      </a>
      <span class="navbar-text fs-5 fw-bold">
        FraudShield - SMS Fraud Detector
      </span>
      <div class="d-flex">
        <a href="/" class="nav-link me-3">Home</a>
        <a href="/cybersafetyhub" class="nav-link">Cyber Safety Hub</a>
      </div>
    </div>
  </nav>

  <div class="main-content">
    <div class="card">
      <h1 class="text-center mb-3 text-primary fw-bold">FraudShield</h1>
      <p class="text-center text-muted mb-4">Detect potential SMS fraud in seconds.</p>

      <div class="mb-3">
        <textarea id="sms" class="form-control" rows="4" placeholder="Paste your SMS message here..."></textarea>
      </div>

      <div class="text-center">
        <button id="checkBtn" class="btn btn-lg btn-primary px-4">Check</button>
      </div>

      <hr>

      <div id="progressContainer" class="mt-3" style="display:none;">
        <label class="form-label fw-semibold">Spam Probability:</label>
        <div class="progress">
          <div id="progressBar" class="progress-bar" role="progressbar" style="width: 0%">0%</div>
        </div>
      </div>

      <div id="result" class="mt-4" style="display:none;">
        <h4 class="fw-bold">Result: <span id="label"></span></h4>
        <p>Cleaned Text: <span id="clean"></span></p>
      </div>
    </div>
  </div>

  <div class="toast text-bg-light border-0" id="demoToast" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="toast-header">
      <strong class="me-auto text-dark">Notification</strong>
      <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
    <div class="toast-body text-dark" id="demoToastBody"></div>
  </div>

  <div id="helpPopup">
    <div class="popup-header">
      <h3 class="popup-title">Are you a victim?</h3>
      <span class="popup-close" id="closeHelp">X</span>
    </div>
    <p class="popup-sub">Don't panic! Take these immediate steps:</p>
    <ul>
      <li>Lock your cards or change your passwords now.</li>
      <li>Contact the Cybercrime Helpline: <strong>1930</strong></li>
      <li>Report at: <a href="https://cybercrime.gov.in" target="_blank">https://cybercrime.gov.in</a></li>
    </ul>
  </div>

  <div id="helpPopupMin">HELP</div>
  <button id="plusBtn">+</button>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const demoMessages = [
      "Congratulations, you have won an Amazon voucher worth ₹10,000. Click the link below to claim your reward: http://freeprize.com",
      "Urgent! You’ve been selected to win ₹10,000 cash prize. Call 09061701461 to claim your reward now.",
      "Hey, are we still meeting for lunch at 1 PM today?",
      "Congrats! You won a free lottery. Claim your cash reward now!",
      "WINNER! You have been selected as a valued customer to receive a ₹500 shopping voucher. Call 09061701461 to claim now.",
      "Don’t forget to send the project files by evening.",
      "You have been specially selected to receive a ₹1000 shopping voucher. Call 09061702893 now to claim your prize."
    ];

    let idx = 0;
    const demoToastEl = document.getElementById('demoToast');
    const demoToast = new bootstrap.Toast(demoToastEl, { delay: 3500 });

    document.getElementById('plusBtn').addEventListener('click', () => {
      const msg = demoMessages[idx];
      document.getElementById('sms').value = msg;
      document.getElementById('demoToastBody').innerText = msg;
      demoToast.show();
      idx = (idx + 1) % demoMessages.length;
    });

    document.getElementById('checkBtn').addEventListener('click', async () => {
      const text = document.getElementById('sms').value.trim();
      if (!text) return alert('Please enter an SMS');
      const resp = await fetch('/predict', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ text })
      });
      const data = await resp.json();
      const prob = data.probability ? (data.probability * 100).toFixed(1) : 0;
      const progressBar = document.getElementById('progressBar');
      document.getElementById('progressContainer').style.display = 'block';
      progressBar.style.width = prob + '%';
      progressBar.innerText = prob + '%';
      progressBar.classList.remove('bg-success', 'bg-danger');
      if (prob < 50) progressBar.classList.add('bg-success');
      else progressBar.classList.add('bg-danger');
      document.getElementById('label').innerText = data.label;
      document.getElementById('clean').innerText = data.clean;
      document.getElementById('result').style.display = 'block';
    });

    const helpPopup = document.getElementById('helpPopup');
    const closeHelp = document.getElementById('closeHelp');
    const helpMin = document.getElementById('helpPopupMin');

    closeHelp.addEventListener('click', () => {
      helpPopup.style.display = 'none';
      helpMin.style.display = 'block';
    });
    helpMin.addEventListener('click', () => {
      helpPopup.style.display = 'block';
      helpMin.style.display = 'none';
    });

    window.addEventListener('load', () => {
      helpPopup.style.display = 'block';
      helpMin.style.display = 'none';
      setTimeout(() => {
        helpPopup.style.display = 'none';
        helpMin.style.display = 'block';
      }, 5500);
    });
  </script>
</body>
</html>